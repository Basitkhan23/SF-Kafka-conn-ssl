version: '2'
services:
    zoo1:
        image: zookeeper
        restart: always
        hostname: zoo1
        ports:
            - "2181:2181"
        environment:
            ZOO_MY_ID: 1
            ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181
    zoo2:
        image: zookeeper
        restart: always
        hostname: zoo2
        ports:
            - "2182:2181"
        environment:
            ZOO_MY_ID: 2
            ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

    zoo3:
        image: zookeeper
        restart: always
        hostname: zoo3
        ports:
            - "2183:2181"
        environment:
            ZOO_MY_ID: 3
            ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181
    broker1:
        image: my_kafka:latest
        hostname: broker1
 #       command: ["sleep", "6000s"]
        ports:
          - "9091:9092"
        depends_on:
          - zoo1
          - zoo2
          - zoo3
        environment:
          KAFKA_BROKER_ID: 1
          KAFKA_ADVERTISED_HOST_NAME: 192.168.43.40
          KAFKA_HOST_NAME: broker1
          KAFKA_ZOOKEEPER_CONNECT: zoo1:2181,zoo2:2181,zoo3:2181
          KAFKA_LISTENERS: SSL://broker1:9092
          KAFKA_ADVERTISED_LISTENERS: SSL://192.168.43.40:9091
          KAFKA_HEAP_OPTS: "-Xmx256M -Xms128M"
          KAFKA_SSL_KEYSTORE_FILENAME: kafka.broker3.keystore.jks
          KAFKA_SSL_KEYSTORE_CREDENTIALS: broker3_keystore_creds
          KAFKA_SSL_KEY_CREDENTIALS: broker3_sslkey_creds
          KAFKA_SSL_TRUSTSTORE_FILENAME: kafka.broker3.truststore.jks
          KAFKA_SSL_TRUSTSTORE_CREDENTIALS: broker3_truststore_creds
          KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: " "
          KAFKA_SSL_CLIENT_AUTH: requested
          KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL
        volumes:
          - ./secrets:/etc/kafka/secrets
    broker2:
        image: my_kafka:latest
      #  command: ["sleep", "6000s"]
        hostname: broker2
        ports:
          - "9092:9092"
        depends_on:
          - zoo1
          - zoo2
          - zoo3
        environment:
          KAFKA_BROKER_ID: 2
          KAFKA_ADVERTISED_HOST_NAME: 192.168.43.40
          KAFKA_HOST_NAME: broker2
          KAFKA_ZOOKEEPER_CONNECT: zoo1:2181,zoo2:2181,zoo3:2181
          KAFKA_LISTENERS: SSL://broker2:9092
          KAFKA_ADVERTISED_LISTENERS: SSL://192.168.43.40:9092
          KAFKA_HEAP_OPTS: "-Xmx256M -Xms128M"
          KAFKA_SSL_KEYSTORE_FILENAME: kafka.broker3.keystore.jks
          KAFKA_SSL_KEYSTORE_CREDENTIALS: broker3_keystore_creds
          KAFKA_SSL_KEY_CREDENTIALS: broker3_sslkey_creds
          KAFKA_SSL_TRUSTSTORE_FILENAME: kafka.broker3.truststore.jks
          KAFKA_SSL_TRUSTSTORE_CREDENTIALS: broker3_truststore_creds
          KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: " "
          KAFKA_SSL_CLIENT_AUTH: requested
          KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL
        volumes:
          - ./secrets:/etc/kafka/secrets  
    broker3:
        image: my_kafka:latest
       # command: ["sleep", "6000s"]
        hostname: broker3
        ports:
          - "9093:9092"
        depends_on:
          - zoo1
          - zoo2
          - zoo3
        environment:
          KAFKA_BROKER_ID: 3
          KAFKA_ADVERTISED_HOST_NAME: 192.168.43.40
          KAFKA_HOST_NAME: broker3
          KAFKA_ZOOKEEPER_CONNECT: zoo1:2181,zoo2:2181,zoo3:2181
          KAFKA_LISTENERS: SSL://broker3:9092
          KAFKA_ADVERTISED_LISTENERS: SSL://192.168.43.40:9093
          KAFKA_HEAP_OPTS: "-Xmx256M -Xms128M"
          KAFKA_SSL_KEYSTORE_FILENAME: kafka.broker3.keystore.jks
          KAFKA_SSL_KEYSTORE_CREDENTIALS: broker3_keystore_creds
          KAFKA_SSL_KEY_CREDENTIALS: broker3_sslkey_creds
          KAFKA_SSL_TRUSTSTORE_FILENAME: kafka.broker3.truststore.jks
          KAFKA_SSL_TRUSTSTORE_CREDENTIALS: broker3_truststore_creds
          KAFKA_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM: " "
          KAFKA_SSL_CLIENT_AUTH: requested
          KAFKA_SECURITY_INTER_BROKER_PROTOCOL: SSL
        volumes:
          - ./secrets:/etc/kafka/secrets
    kafka-manager:
        image: sheepkiller/kafka-manager
        environment:
          ZK_HOSTS: zoo1:2181,zoo2:2181,zoo3:2181
        logging:
          options:
            max-file: "5"
            max-size: "10m"
        ports:
           - "9000:9000"
